# Chapter 10, API 아키텍처

Created: November 14, 2021

백엔드 API 코드의 전체 구조, 즉 코드의 아키텍처에 대해 알아볼 것이다. 왜 코드의 아키텍쳐가 중요한지 알아볼 것이고, 널리 사용되는 아키텍쳐 패턴에 대해서 알아본다.

## 코드 구조의 중요성

지금까지 구현한 미니터 API의 경우, [app.py](http://app.py) 라는 하나의 파일에 모든 코드가 들어 있다. 모든 코드를 한 파일에서 확인할 수 있으므로 복잡성을 줄이고, 개발 과정이 전체적으로 간단해진다. 

하지만 특별한 코드의 구조 없이 한 파일에 모든 코드를 구현하는 것은 코드의 양이 많아질수록 복잡해질 수 있다. 실제로는 논리적으로 혹은 기능적으로 영역을 구분하여 코드를 관리하는 것이 좋다. 이렇게 코드의 구조를 더 체계적으로 그리고 효율적으로 구현하는 것을 코드의 아키텍처라 한다.

코드 아키텍처를 체계적이고 효율적으로 구성하기 위해서는 다음과 같은 요소들을 염두에 두어야 한다.

- 확장성
- 재사용성
- 보수 유지 가능성
- 가독성
- 테스트 가능성

## 레이어드 패턴

좋은 코드의 구조를 생각해내기란 쉅지 않은 문제이지만 다행히도 코드의 구조를 어떻게 구성하고 관리해야 하는 문제는 이미 많이 다루어진 문제이기 떄문에 가장 널리 사용되고 검증된 좋은 패턴을 사용하는 것이 좋다. 

백엔드 API에 가장 널리 적용되는 패턴 중 하나는 레이어드 아키텍처 패턴이다. Multi-tier 아키텍처 패턴이라고도 불리며 이러한 아키텍처는 코드를 논리적인 부분 혹은 역할에 따라 독립된 모듈로 나누어서 구성하는 패턴이다. 그리고 각 모듈이 서로의 의존도에 따라 층층히 쌓듯이 연결되어서 전체의 시스템을 연결하는 구조.

일반적으로 다음과 같은 3개의 레이어가 존재한다.

- presentation layer
- business layer
- persistence layer

### view(presentation layer)

Presentation layer는 해당 시스템을 사용하는 사용자 혹은 클라이언트 시스템과 직접적으로 연결되는 부분이다. 웹사이트에서는 UI부분에 해당하고 백엔드 API에서는 엔드포인트 부분에 해당한다. 그러므로 API의 엔드포인트들을 정의하고 전송된 HTTP 요청들을 읽어 들이는 로직을 구현한다.

### service(business layer)

실제 시스템이 구현해야 하는 로직들을 이 레이어에서 구현하게 된다.

### persistence layer

데이터베이스와 관련된 로직을 구현하는 부분이다. business layer에서 필요한 데이터 생성, 수정, 읽기등을 처리하여 실제로 데이터베이스에서 데이터를 저장, 수정, 읽어 들이기를 하는 역할을 한다.

### 레이어드 아키텍처의 핵심 요소

레이어드 아키텍처의 핵심 요소는 바로 단방향 의존성이다. 각각의 레이어는 오직 자기보다 하위에 있는 레이어에만 의존하게 된다.

또 다른 핵심 요소는 "seperation of concerns'이다. 즉 각 레이어의 역할이 명확하다는 뜻이다. 그렇기 때문에 각 레이어가 서로 독립적이고 역할이 분명하므로 서로에게 끼치는 영향을 최소화하면서 확장하거나 수정할 수 있다.